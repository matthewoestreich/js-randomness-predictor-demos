<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>js-randomness-predictor vanilla-js</title>
  </head>
  <body>
    <table border="1" cellpadding="8" cellspacing="0">
      <thead>
        <tr>
          <th>Browser</th>
          <th>Supported?</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="your-current-browser"></td>
          <td id="is-your-current-browser-supported"></td>
        </tr>
      </tbody>
    </table>
    <br />
    <div id="predictor-section" style="display: none">
      <button id="make-prediction">Make Prediction</button>
      <button id="call-math-random">Call Math.random()</button>
      <p id="status"></p>
      <h1>Predictions</h1>
      <div id="predictions"></div>
      <h1>Actual Rands</h1>
      <div id="actual-randoms"></div>
    </div>
    <script src="coi.serviceworker.js"></script>
    <script src="z3-built.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-randomness-predictor@2.4.3/dist/umd/js-randomness-predictor.min.js"></script>
    <script>
      const elStatus = document.getElementById("status");
      const elPredictorSection = document.getElementById("predictor-section");
      const elMakePrediction = document.getElementById("make-prediction");
      const elCallMathRandom = document.getElementById("call-math-random");
      const elPredictions = document.getElementById("predictions");
      const elActualRandoms = document.getElementById("actual-randoms");

      const CURRENT_BROWSER = getCurrentBrowser();
      const IS_SUPPORTED_BROWSER = isCurrentBrowserSupported(CURRENT_BROWSER);

      let PREDICTOR = null;

      document.getElementById("your-current-browser").innerText = CURRENT_BROWSER === "" ? "UNRECOGNIZED BROWSER" : CURRENT_BROWSER;
      document.getElementById("is-your-current-browser-supported").innerText = IS_SUPPORTED_BROWSER ? "Yes" : "No";

      if (IS_SUPPORTED_BROWSER) {
        elPredictorSection.style.display = "block";
        PREDICTOR = JSRandomnessPredictor[CURRENT_BROWSER](callMathRandom(4));

        elMakePrediction.addEventListener("click", async (e) => {
          elMakePrediction.disabled = true;
          elStatus.innerText = "STATUS: Working..."
          const p = await PREDICTOR.predictNext();
          elPredictions.innerText += p + "\n";
          elMakePrediction.disabled = false;
          elStatus.innerText = "";
        });

        elCallMathRandom.addEventListener("click", (e) => {
          elActualRandoms.innerText += Math.random() + "\n";
        });
      }

      function callMathRandom(nTimes = 1) {
        const output = [];
        for (let i = 0; i < nTimes; i++) {
          output.push(Math.random());
        }
        return output;
      }

      function getCurrentBrowser() {
        const userAgent = navigator.userAgent;
        if (userAgent.indexOf("Chrome") > -1) {
          return "chrome";
        } else if (userAgent.indexOf("Firefox") > -1) {
          return "firefox";
        } else if (userAgent.indexOf("Safari") > -1) {
          return "safari";
        } else if (userAgent.indexOf("Edge") > -1) {
          return "edge";
        } else if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) {
          return "opera";
        } else if (userAgent.indexOf("MSIE") > -1 || userAgent.indexOf("Trident/") > -1) {
          return "internetExplorer";
        }
        return "";
      }

      function isCurrentBrowserSupported(currentBrowser = "") {
        const supportedBrowsers = ["chrome", "firefox", "safari"];
        return !(currentBrowser === "" || !currentBrowser) && supportedBrowsers.includes(currentBrowser);
      }

      /**
       * Main function
       */
      async function Main() {
        try {
          const ffp = JSRandomnessPredictor[CURRENT_BROWSER](Array.from({ length: 4 }, Math.random));
          console.log({ status: "created firefox pred.." });

          const predictions = [];
          console.log("Making first prediction");
          const first = await ffp.predictNext();
          predictions.push(first);
          console.log("made first prediction");

          for (let i = 0; i < 9; i++) {
            predictions.push(await ffp.predictNext());
            console.log(`${i + 1}. Prediction Made`);
          }

          const actuals = Array.from({ length: 10 }, Math.random);

          console.log({ predictions, actuals, isAccurate: predictions.every((v, i) => actuals[i] === v) });
        } catch (e) {
          console.log("ERROR IN PREDICTOR", e);
        }
      }
    </script>
  </body>
</html>